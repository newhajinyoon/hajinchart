/*!
 * @author 김승일
 * @email comahead@vi-nyl.com
 * @description 멜론 프레임웍
 */
;!(function(i,m,c,g){var b=m.Class,f=m.date,k=m.string,e=m.number,h=i(document),d=i(window);c.WeekCalendar.prototype.defaults.getCaption=function(t,v,u,p,s,r,n,q){var o=u+"."+p+"."+s+"~"+r+"."+n+"."+q;switch(t){case"active":return o+" (선택하신 주간 "+this.options.title+"입니다.)";case"normal":return o+" "+this.options.title+" - 페이지 이동";case"before":return o+" ("+this.limitWeek+"주 이내의 데이터만 조회가 가능합니다)";case"after":return o+" (해당 "+this.options.title+"(은)는 아직 집계되지 않았습니다.)"}return""};c.WeekCalendar.prototype.defaults.getTitle=c.WeekCalendar.prototype.defaults.getCaption;c.MonthCalendar.prototype.defaults.getTitle=function(o,n,p){switch(o){case"active":return p+"월 "+this.options.title+"";case"normal":return p+"월 "+this.options.title+" - 페이지 이동";case"before":return"("+this.limitDate.getFullYear()+"년도 "+(this.limitDate.getMonth()+1)+"월까지의 데이터만 조회가 가능합니다.)";case"after":return"(해당 "+this.options.title+"(은)는 아직 집계되지 않았습니다.)"}return""};m.define("PBPGN.SearchChart",function(){var r=["age","year","mon","day","classCd"],q=["WE","MO","YE","AG","MV","AL","NS"],p=m.string,t=m.array,o=["decade","year","month","week","gnr"],n=false;var s=b({name:"SearchChart",$extend:MELON.PBPGN.View,selectors:{container:"div.wrap_chart",panels:"div.box_chic",inputs:"input[type=hidden]"},events:{"click h4>a":"onSelectedChartType","click div.list_value input:radio":function(w){var u=this,v=i(w.currentTarget),x=v.closest("div.box_chic").index()+1;v.closest("div.box_chic.view").addClass("on");v.closest("li").siblings().removeClass("on").end().addClass("on");u.onSelectedItem(x)}},defaults:{searchUrl:"searchchart_data.html",timeout:5000},initialize:function(v,u){var w=this;if(w.supr(v,u)===false){return}w.chartType="";w.$el.find(".list_value").mouseHover("li")},onSelectedChartType:function(w){w.preventDefault();var u=this,v=i(w.currentTarget);u.chartType=v.attr("data-value");u.$container.insertAfter(v.parent());u.$el.find(">h3").addClass("on");u.$panels.find("div.list_bass>ul").show();v.parent().activeRow("on");v.next().prop("checked",true);u._loadItems(0)},onSelectedItem:function(w){var v=this,u=v.chartType;if(w>4){v.trigger("selected",[v._makeParams(w)]);return}switch(u){case"WE":case"MO":case"YE":case"AG":if(w+t.indexOf(q,u)>=4){v.$panels.filter(":gt("+(w-1)+")").find("div.list_bass>ul").hide();w=4}case"NS":case"MV":case"AL":break}if((u=="AL"||u=="MV")&&w===4){return}v._loadItems(w)},_makeParams:function(x){var v=this,w={chartType:v.chartType,searchDepth:x};v.$panels.each(function(z){var A=i(this),y=A.find("div.list_value input:radio:checked");if(A.hasClass("on")){w[r[z]]=y.val()}});if(w.day){var u=w.day.replace(/:/g,"").split("^");w.startDay=u[0];w.endDay=u[1]}return w},_loadItems:function(y){if(n){return}n=true;var w=this,v=w.options.searchUrl,x=w._makeParams(y),u=new i.Deferred();w._disabledSubPanels(y);if(w.options.getUrl){v=w.options.getUrl(y,x);if(typeof v!=="undefined"&&typeof v!=="string"){v=v.url;x=v.params}}i.ajax({url:v,data:x,method:"post",dataType:"json",beforeSend:function(){},timeout:w.options.timeout}).done(function(z){if(z&&z.success===true){u.resolveWith(w,[y,z])}else{u.rejectWith(w,[y,z])}}).fail(function(){u.rejectWith(w)}).always(function(){n=false});u.done(function(A,z){w._fillItems(A,z.itemData);w.$panels.eq(A).removeClass("on").addClass("view")}).fail(function(){alert("죄송합니다. 알수 없는 이유로 중단되었습니다.")})},_disabledSubPanels:function(w){var u=this,v={};u.$panels.each(function(x){if(w>x){return}var y=i(this);y.removeClass("view").removeClass("on").find("div.list_value li").remove()})},_fillItems:function(x,y){var C=this,u=C.$panels,B=y,A="";var E="",z="ITEMNM",v="ITEMVAL";switch(x){case 0:E="년대";z="SYEAR";v="SYEAR";break;case 1:E="년";z="SYEAR";v="SYEAR";break;case 2:E="월";z="SMON";v="SMON";break;case 4:E="";z="CHARTNM";v="CHARTCODE";break}if(B&&B.length>0){for(var w=0,D;D=B[w++];){A+=["<li><span>",'<input type="radio" name="'+r[x]+'" id="'+o[x]+"_"+w+'" class="input_radio" value="'+D[v]+'" caption ="'+D[z]+E+'" />','<label for="'+o[x]+"_"+w+'">'+D[z]+E+"</label>","</span></li>"].join("")}}C.$panels.eq(x).find("div.list_value>ul").html(A)},getValue:function(u){return this._makeParams(u)},destroy:function(){var u=this;u.supr()}});m.bindjQuery(s,"searchChart");return s});m.define("PBPGN.TimeSlider",function(){var n=b({name:"TimeSlider",$extend:MELON.PBPGN.View,defaults:{orientation:"horizontal",duration:300,easing:"ease-in-out",animate:true,render:false},selectors:{sliderBox:".d_slider_box",panel:".d_panel",prevArrow:".d_prev",nextArrow:".d_next"},initialize:function(p,o){var q=this;if(q.supr(p,o)===false){q.destroy();return}q.lastTime=q.options.lastTime||q.$el.attr("data-last-time")||f.format(new Date(),"hh:00");q._activeTime=q.options.activeTime||q.$el.attr("data-active-time")||q.lastTime;q._enableTimes=q.options.enableTimes||q.$el.attr("data-disable-times")||"";q._initTimeSlider();q.active(q._activeTime)},_initTimeSlider:function(){var o=this;o.$panel.css("width",o.totalWidth);o.$prevArrow.on("click",function(){o._slide("prev")});o.$nextArrow.on("click",function(){o._slide("next")});o.on("click","a",function(p){p.preventDefault();o.trigger("selected",[i(this).text()])})},active:function(r){var p=this,q=0,s=0,o=r.match(/^\d+/);if(o){p._activeTime=r;p.options.render&&p.render();p.$items=p.$panel.find(">li");p.itemCount=p.$items.length;p.moveWidth=p.$sliderBox.width();p.itemWidth=p.$items.eq(0).width();p.totalWidth=p.itemWidth*p.itemCount;p.limitLeft=p.moveWidth-p.totalWidth;s=Math.floor((p.moveWidth/p.itemWidth)/2);o=parseInt(o[0],10);if(o<s){q=0}else{if(s>=(p.itemCount-o)){q=p.limitLeft}else{q=-((o-s)*p.itemWidth)}}p._slide("cur",q)}},_slide:function(o,q){var p=this;q=typeof q==="undefined"?parseInt(p.$panel.css("left"),10):q;if(o==="prev"){q=Math.min(0,q+p.moveWidth)}else{if(o==="next"){q=Math.max(p.limitLeft,q-p.moveWidth)}}p.$panel.stop().animate({left:q},{easing:"easeInOutCubic",duration:600});if(q===0){p.$prevArrow.addClass("disabled").prop("disabled",true);p.$nextArrow.removeClass("disabled").prop("disabled",false)}else{if(q===p.limitLeft){p.$prevArrow.removeClass("disabled").prop("disabled",false);p.$nextArrow.addClass("disabled").prop("disabled",true)}else{p.$prevArrow.removeClass("disabled").prop("disabled",false);p.$nextArrow.removeClass("disabled").prop("disabled",false)}}},render:function(){var u=this,o=parseInt(u.lastTime.split(":")[0],10),r="",s,q,v;for(var p=0;p<24;p++){s=e.zeroPad(p),q=s+":00";v=(q===u._activeTime);if(!v&&p<=o){if(u._enableTimes.indexOf(s)>=0){r+='<li data-time="'+q+'"><a href="#" title="'+s+'시 실시간 급상승 TOP100 페이지로 이동">'+q+"</a></li>"}else{r+='<li data-time="'+q+'"><span>'+q+"</span></li>"}}else{r+='<li data-time="'+q+'"'+(v?' class="on"':"")+"><span>"+q+"</span></li>"}}u.$panel.html(r)}});m.bindjQuery(n,"timeSlider");return n});var l=b({$extend:c.View,name:"timeline",defaults:{arrowHeight:48,boxTopMargin:24},initialize:function(o,n){var p=this;if(p.supr(o,n)===false){return}p.measure={left:0,center:0,right:0};p.update()},update:function(t){t=t||0;var p=this,s=p.$el.find(">ul>li").filter(function(u){return u>=t}),n=[],o=p.measure,r=p.options.arrowHeight,q=p.options.boxTopMargin;p.$el.css("visibility","hidden").show();if(t===0){o.left=o.center=o.right=0}s.each(function(v){var z=i(this),x=z.show().height(),y,w,u;y=(o.left<=o.right)?"left":"right";w=o[y];u=Math.max(o.center-w,0);n.push({$target:z.hide(),css:y,top:w,arrowTop:u});o[y]+=x+q;o.center=w+u+r});i.each(n,function(u,v){v.$target.removeClass("lc_left lc_right").addClass("lc_"+v.css).css({top:v.top}).fadeIn("slow").find("div.wrap_icon").css({top:v.arrowTop})});p.$el.css({visibility:"",height:Math.max(o.left,o.right)});p.triggerHandler("completed")}});m.bindjQuery(l,"timeline");var j=b({name:"RollingCounter",$extend:MELON.PBPGN.View,$statics:{ON_ROLLING_END:"rollingcounterend"},defaults:{height:75,duration:1000,delay:300,easing:"easeInOutQuart"},initialize:function(o,n){var p=this;if(p.supr(o,n)===false){return}p._$items=[].reverse.call(p.$el.find(">span"));p._numbers=(p.$el.attr("data-value")||parseInt(p.$el.text()||0))+"";p.start()},start:function(){var q=this,p=q.options,o=[].reverse.call(q._numbers.split("")).join(""),r=MELON.WEBSVC.css,s=p.easing,n=o.length;q._$items.attr("style","background-position:0 75px").stop(true).each(function(u){if(u>=n){return false}var t=i(this),w=parseInt(o.substr(u,1),10),v=((w*p.height)+750);t.data("number",w);t.delay(u*p.delay).queue(function(){t.prop({ypos:-v}).stop().animate({ypos:0},{duration:p.duration,easing:p.easing,step:function(x){t.css("background-position","0 "+(v+x+75)+"px")}});t.dequeue()});t.children().html(w)})},update:function(o){var n=this;n.$el.attr("data-value",o);n._numbers=o+"";n._$items.attr("style","background-position:0 75px").children().html(0);n.start()}});m.bindjQuery(j,"rollingCounter");var a=b({name:"TimeCountdown",$extend:MELON.PBPGN.View,$statics:{ON_TIMER_END:"timecountdownend",ON_TIMER_SOON:"timecountdownsoon"},defaults:{height:75,duration:400,easing:"easeInOutQuart",serverTime:0,limits:[9,5,9,5,9,9]},initialize:function(o,n){var p=this;if(p.supr(o,n)===false){p.destroy();return}p._time=m.date.parseDate(p.options.time);p._timeGap=(+new Date)-p.options.serverTime;p._$items=[].reverse.call(p.$el.find(">span:even > span"));p._init();p._timer()},_init:function(){var o=this,p=o._time.getTime()-(+new Date)+o._timeGap;if(p<0){return}var n=o._convertReverseTime(p);o._$items.data("number",0).children().html(0);o._$items.each(function(r){if(r>=n.length){return false}var q=o._$items.eq(r),s=n.substr(r,1);if(s==q.data("number")){return}q.data("number",s).html(s)})},_timer:function(){var o=this,p=o._time.getTime();var q=null;if(p<0){clearTimeout(q);o.$el.triggerHandler(a.ON_TIMER_END);clearInterval(o.interval);return}var n=(p-(+new Date)+o._timeGap)/1000/3600;if(n>0&&n<24){q=setTimeout(function(){o.$el.triggerHandler(a.ON_TIMER_SOON)},0)}o.interval=setInterval(function(){var r=p-(+new Date)+o._timeGap;if(r<=0){clearInterval(o.interval);o.$el.triggerHandler(a.ON_TIMER_END)}else{o._update(r)}},200)},_convertReverseTime:function(p){var r=m.number.zeroPad,s=0,n=0,q=0,o=0;p=p/1000;s=Math.floor(p/86400),p=p%86400;n=Math.floor(p/3600),p=p%3600;q=Math.floor(p/60),p=p%60;o=Math.floor(p);return[].reverse.call((r(n+(24*s))+r(q)+r(o)).split("")).join("")},_update:function(r){var q=this,p=q.options,o=p.limits,n=q._convertReverseTime(r);q._$items.each(function(t){if(t>=n.length){return false}var s=q._$items.eq(t),u=s.data("number"),w=n.substr(t,1),v;if(w==u){return}s.data("number",w).html(w);v=(w+1)*p.height})}});m.bindjQuery(a,"timeCountdown")})(jQuery,MELON.WEBSVC,MELON.PBPGN);$(function(){$("div.summ_prid").on("showcalendar hidecalendar",function(a){if(a.type==="showcalendar"){$(this).addClass("on")}else{$(this).removeClass("on")}})});/* melonweb_chart.js */